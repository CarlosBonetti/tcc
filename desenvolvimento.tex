% !TEX root = main.tex

\chapter{O Sistema de Integração Lattes-Qualis (SILQ)}

O presente trabalho é uma continuação dos esforços iniciados por \cite{Silq1}. Neste capítulo, portanto, será apresentado o histórico do trabalho original, os motivos que levaram ao desenvolvimento de um novo trabalho para sua continuação, comparações do que foi de fato alterado no sistema e por que estas alterações foram necessárias.

Para mais fácil compreensão e contextualização, durante o texto serão utilizados os termos ``trabalho original", ``artigo original", ``SILQ-1" ou ainda ``primeira versão do sistema" ou sinônimos para referir-se ao trabalho de \cite{Silq1}. Em contrapartida, os termos, ``SILQ-2", ``nova versão do sistema" e derivados referem-se a este trabalho.

\section{Histório e Visão Geral do SILQ-1}

Este trabalho é uma continuação de \cite{Silq1}, um Trabalho de Conclusão de Curso de alunos do curso de Ciência da Computação da UFSC, orientados pela Professora Carina F. Dorneles. O objetivo deste trabalho de 2015 era a criação de um sistema que deveria ser capaz de ``qualificar produções científicas, no quesito artigos e participações em conferências, por busca por similaridade de dados com os dados extraídos do WebQualis" \cite[p. 26-27]{Silq1}. Este objetivo foi alcançado com a criação da primeira versão do Sistema de Integração Lattes-Qualis (SILQ), lançado no segundo semestre de 2015 e disponível no sítio \url{http://silq.inf.ufsc.br/}.

Apesar de estável e com sua função principal sendo desempenhada de forma satisfatória, o SILQ-1 deixou algumas lacunas e melhorias a serem desenvolvidas por trabalhos futuros. Segundo os próprios autores, ``[...] o SILQ foi concebido para ser uma ferramenta de domínio público e vários projetos devem nascer a partir dele. A continuidade do projeto só tem a acrescentar ao mundo acadêmico [...]" \cite[p. 79]{Silq1}, o que motivou a criação deste trabalho para a continuação do projeto original. O ponto de partida deste trabalho, portanto, foi a seção ``Trabalhos futuros" do artigo original.

\subsection{``Trabalhos futuros" citados pelo SILQ-1}

Na seção de ``Conclusões e Tabalhos Futuros" do artigo original, \cite{Silq1} citam 8 itens de melhoria que poderiam ser revisitados por trabalhos futuros. Cada um destes itens está exposto abaixo junto uma explicação de quais foram as atitudes tomadas por este trabalho para resolvê-las.

\begin{enumerate}

\item \textbf{Controle de persistência e transações}

\begin{citacao}
definir um novo container de execução para automatizar o uso de uma API de persistência. No momento, as transações são controladas de forma manual; \cite[p. 79]{Silq1}
\end{citacao}

Esta melhoria trata-se de um detalhe de implementação do SILQ-1 que, devido à sua arquitetura, forçava a criação e gerenciamento manual de transações ao realizar acessos ao banco de dados. A automatização desta tarefa foi rapidamente alcançada no SILQ-2 com a utilização do \textit{Spring Framework}, conforme relatado na seção \ref{sec:arquitetura-silq-2}.

\item \textbf{Automatização da atualização dos dados Qualis}

\begin{citacao}
as publicações periódicas dos documentos de avaliação do WebQualis levam à necessidade de atualizar o banco de dados periodicamente. A construção de uma funcionalidade automatizada é pertinente; \cite[p. 79]{Silq1}
\end{citacao}

Os dados Qualis utilizados pelo sistema para realizar a avaliação de currículos são atualmente inseridos de forma manual. Na segunda etapa deste trabalho será incluído um módulo no sistema onde administradores poderão fazer \textit{upload} de novos dados Qualis, conforme eles forem sendo divulgados e assim não necessitando inserí-los de forma manual no banco de dados.

Os dados Qualis 2013 e 2014, divulgados somente no ano de 2016, entretanto, já foram inseridos manualmente na base de dados do SILQ-2, passando por um processo de limpeza de dados descrito na seção \ref{sec:extracao-qualis-novo}.

\item \textbf{\textit{Fine-tuning} da função de similaridade}

\begin{citacao}
desenvolvimento de uma nova função de similaridade ou novos procedimentos de cálculo de similaridades. Foram testadas funções já bem conhecidas pela comunidade científica, com testes concretos para levantar qual delas é a mais indicada no escopo da ferramenta. Porém, é possível que se alcance resultados melhores utilizando uma combinação de funções, ou até mesmo criando uma nova especificamente para o cálculo de similaridade de nomes de periódicos e conferências; \cite[p. 79]{Silq1}
\end{citacao}

Os testes realizados pelos autores do trabalho original somente levaram em conta o tempo de processamento entre diferentes tipos de algoritmos de similaridade textual, escolhendo a função \textit{trigram} em detrimento das outras por sua integração nativa com o PostgreSQL e por seu tempo de resposta superior aos outros métodos \cite[p. 57-58]{Silq1}. Não foi realizada, porém, uma comparação da acurácia dos resultados de diferentes métodos de similaridade.

Um dos objetivos do presente trabalho é a estipulação das métricas de precisão e revocação (\textit{precision} e \textit{recall}) para o algoritmo de avaliação atual. Esta atividade ainda será realizada (na segunda etapa deste trabalho), porém com enfoque no uso de feedback de usuários para aumento de acurácia. Após a obtenção destas métricas, entretanto, será possível comparar outros algoritmos de similaridade textual, além do \textit{trigram} utilizado atualmente, com a finalidade de escolher o melhor para a situação. Todavia, esta comparação de diferentes algoritmos não é um dos focos deste trabalho.

\item \textbf{Considerar outras informações do pesquisador}

\begin{citacao}
levantamento das outras informações contidas no currículo, como o desempenho do pesquisador antes de ser incluído em um grupo de pós-graduação ou a quantidade e a qualidade de outras atividade acadêmicas; \cite[p. 79]{Silq1}
\end{citacao}

Este item envolve o processamento de outras informações contidas no currículo Lattes de um pesquisador e, em um primeiro momento, foge do escopo original do SILQ que é a integração entre o Lattes e o Qualis, utilizando as publicações e informações de onde foram publicadas/apresentadas como item de avaliação.

Por este motivo, este item não foi abordado neste trabalho. Todavia, outros trabalhos de pesquisa relacionados estão paralelamente em desenvolvimento.

\item \textbf{Relação entre orientações e produções associadas}

\begin{citacao}
levantamento da relação entre as atividades de orientação,   como bolsas de iniciação científica, e as produções acadêmicas associadas; \cite[p. 80]{Silq1}
\end{citacao}

Não foi abordado neste trabalho, pelos mesmos motivos do item anterior.

\item \textbf{Busca por informações de eventos}

\begin{citacao}
expansão do módulo da busca por informações de eventos. A complexidade do tema impediu o desenvolvimento completo desse módulo na ferramenta SILQ. Procedimentos automáticos de busca utilizando-se web crawlers e o tratamento correto dessas informações fornecem muitos temas para desenvolvimento de módulos novos; \cite[p. 80]{Silq1}
\end{citacao}

A inserção de dados do Qualis Conferência\footnote{dados e conceitos relacionados a eventos científicos disponibilizados pela CAPES para algumas áreas específicas} no sistema se dá de forma manual, à medida em que novas informações são disponibilizadas pela CAPES. O objetivo deste item seria a criação de um \textit{web crawler} para captura automática de dados de eventos científicos na web. Devido à complexidade deste tema e por se tratar de um assunto independente, não relacionado com o foco deste trabalho, este item não foi abordado.

\item \textbf{Feedback do usuário}

\begin{citacao}
permitir que o usuário auxilie a ferramenta na qualificação, ou seja, no caso dele observar algum matching errado, ele próprio pode sugerir o matching correto; \cite[p. 80]{Silq1}
\end{citacao}

Este é o ponto de análise principal deste trabalho e que deu origem à hipótese de pesquisa. É possível aumentar a precisão da ferramenta de qualificação, de uma maneira geral, utilizando sugestões (ou feedback) de usuários? Para responder à esta pergunta, entretanto, antes é necessário estipular métricas para calcular o grau de precisão atual da ferramenta e então comparar o algoritmo antigo com um novo que leve em consideração estas sugestões. Este será o foco da próxima etapa deste trabalho.

\item \textbf{Período de participação em grupo de pesquisa}

\begin{citacao}
indicar o período em que o professor está vinculado à um programa de pós-graduação, permitindo que as avaliações dos currículos também possam ser realizadas considerando-se apenas os períodos nos quais o pesqisador estava vinculado à esse programa. \cite[p. 80]{Silq1}
\end{citacao}

Este item trata-se de um detalhe de gerenciamento de grupos e de sua avaliação, que considera publicações de um pesquisador mesmo quando este foi membro do grupo em um período que não cobre totalmente o período de avaliação estipulado. Para correção deste comportamento, basta dar ao administrador do grupo a opção de informar o período de ingresso ou de participação de um pequisador no grupo de pesquisa e atualizar o algoritmo de avaliação para considerar somente publicações neste período. Trata-se, também, de uma modificação que será introduzida nas próximas iterações de desenvolvimento deste trabalho.

\end{enumerate}

\section{SILQ 2}

\subsection{Extração e inserção dos novos dados Qualis} \label{sec:extracao-qualis-novo}

Os dados Qualis de eventos e periódicos foram extraídos pelo trabalho original a partir de documentos em PDF e planilhas. Como relatado em \cite[p. 50-52]{Silq1}, os dados foram extraídos dos PDFs utilizando bibliotecas para manipulação deste formato e passaram por um processo de limpeza. A partir deste processo, aproximadamente 107 mil tuplas foram criadas representando os períodicos do triênio 2010-2012.

No primeiro semestre do ano de 2016, porém, a CAPES disponibilizou novos dados Qualis referentes ao ano de 2013 e 2014, alterando sua periodicidade de avaliação de trimestral para anual. Estes novos dados foram divulgados em formado CSV, junto com os antigos dados do triênio 2010-2012, mas desta vez separados por ano. Estes dados foram obtidos pela plataforma Sucupira (antigo WebQualis): \url{http://qualis.capes.gov.br/webqualis/}.

Como o conjunto de dados do SILQ-1 contava apenas com dados trimestrais, as tuplas originais não possuíam informação de ano (só podia-se deduzir que os dados faziam parte do triênio, mas não de qual ano). Desta forma, todos as planilhas divulgadas passaram por um novo processo de extração, incluindo os dados já inseridos no SILQ-1, mas agora considerando a nova informação de ano.

As cinco novas planilhas passaram por um processo de \textit{data cleaning} manual:

\begin{enumerate}

\item Substituição de entidades HTML especiais por seu caractere correspondente. Ex.: ``\texttt{\&amp;}" por ``\texttt{\&}";

\item Normalização do campo ISSN para o formato ``9999-9999": alguns registros não possuíam o dígito separador ou omitiam os zeros à esquerda;

\item Correção de ISSNs errôneos: alguns registros possuíam o campo ISSN com dígitos faltando. Ex.: 0034-167 (Revista Brasileira de Enfermagem), cujo número correto seria 0034-\textbf{7}167. Estes casos foram tratados um a um e os números corretos identificados através de pesquisas na web.

\end{enumerate}

As planilhas CSV foram então dadas como \textit{input} à base de dados resultando na criação de 339204 tuplas, referentes a cada um dos anos do período divulgado 2012-2015. A Tabela \ref{tab:n-registros-extraidos} mostra o número de períodicos extraídos para cada ano de avaliação do Qualis.

\begin{table}[!h]
\begin{center}
\caption{Número de períodicos extraídos dos dados Qualis}\label{tab:n-registros-extraidos}
\begin{tabular}{ c | c }
\hline
\textbf{Ano} & \textbf{N° de periódicos extraídos} \\ \hline
2010 & 75786 \\ \hline
2011 & 66171 \\ \hline
2012 & 108272 \\ \hline
2013 & 44437 \\ \hline
2014 & 44538 \\ \hline
\textbf{Total} & \textbf{339204} \\ \hline
\end{tabular}
\end{center}
\end{table}

Após esta etapa, verificou-se que todos os registros da base de dados antiga do SILQ-1 estavam contidos nesta nova versão. Desta forma, os dados do SILQ-1 foram mantidos, porém agora incluindo o ano de avaliação, além do nome do periódico, ISSN, conceito atribuído pela CAPES e área de avaliação.

A inclusão dos novos registros aumentou o número de publicações passíveis de serem avaliadas pelo sistema. Os dados Qualis de 2015 e 2016 ainda não foram divulgados no momento de escrita deste artigo, mas podem ser incluídos facilmente na base de dados assim que forem disponibilizados pela CAPES.

\subsection{Criação do \textit{Web Service}} \label{sec:arquitetura-silq-2}

A primeira versão do SILQ foi desenvolvida com base no \textit{Play\footnote{\url{https://www.playframework.com/}
} Framework}, um \textit{web application framework} escrito em Java e Scala que simplifica o processo de construção de uma aplicação web. Este mesmo framework provê APIs e bibliotecas para o desenvolvimento tanto do \textit{back-end} quando do \textit{front-end} de uma aplicação web.

Para esta nova versão do SILQ, porém, um dos objetivos seria a criação de uma API de integração programática, tornando o SILQ não só um sistema para uso de usuários finais, mas também para integração com outras ferramentas, como um \textit{web service}. Para tanto, uma alteração significativa na arquitetura da aplicação foi feita, separando o sistema em um \textit{server-side} rodando Spring\footnote{\url{http://projects.spring.io/spring-framework/}} e servindo seu conteúdo através de uma API REST; e um \textit{client-side} remodelado utilizando AngularJS\footnote{\url{https://angularjs.org/}} e consumindo o serviço através de requisições HTTP.

Em um primeiro momento, o ``núcleo" do SILQ, que inclui os algoritmos de avaliação e processamento dos currículos, não foi alterado, apenas a forma com que este serviço é disponibilizado e consumido. Desta forma, a linguagem utilizada no sistema, o Java, foi mantido. A escolha da alteração do framework back-end, de \textit{Play!} para \textit{Spring}, se deu ao fato da mudança no paradigma arquitetural da aplicação, com a introdução da camada REST. O Spring se trata de um framework Java \textit{open-source} largamente utilizado pela comunidade que oferece suporte a vários aspectos de uma aplicação web, incluindo a construção de interfaces RESTful.

A figura \ref{fig:arquitetura} mostra um esquema da nova arquitetura do SILQ. Na figura, a caixa ``SILQ Core" representa a camada de serviço da aplicação, responsável pelo acesso ao banco de dados, avaliação de currículos e gerenciamento dos dados Qualis, cuja implementação foi realizada no trabalho passado (apesar de também sofrer algumas mudanças tecnológicas no trabalho atual).

\begin{figure}[!h]
   \centering
   \caption{Nova arquitetura do SILQ.}
   \label{fig:arquitetura}
   \includegraphics[width=\textwidth]{figuras/arquitetura-silq.png}
\end{figure}

\subsection{Alterações no \textit{front-end}}

Na primeira versão do SILQ, as páginas HTML do sistema eram dinamicamente renderizadas no server-side pelo \textit{Play!} Framework e servidas conforme as requisições dos clientes. Desta forma, além de executar toda a lógica de aplicação, o servidor também fica responsável pela lógica de apresentação do conteúdo.

Em arquiteturas REST, a lógica de apresentação de dados (ou visão), fica completamente separada do servidor, executando no \textit{web browser} do cliente. Ou seja, o servidor só recebe requisições HTTP, as processa e retorna uma resposta em formato JSON. Esta resposta é recebida pelo cliente que então apresenta o conteúdo através da interface gráfica HTML renderizada pelo browser. Desta forma, a carga no servidor é diminuída, já que ele não está mais incumbido da tarefa de renderização das páginas HTML que serão servidas.

Utilizando esta ideia, no SILQ-2, a camada de visão foi totalmente reescrita em \textit{Javascript}, utilizando o framework \textit{AngularJS}. Trata-se de um framework \textit{open-source} desenvolvido pela Google que auxilia na criação de interfaces web dinâmicas e integração com \textit{webservices} via REST.

Desta forma, quando um cliente realiza a primeira requisição à URL do SILQ, o servidor serve uma página HTML (geralmente denominada de \textit{index}) junto com os \textit{assets} necessários para a construção de conteúdo dinâmico e estilização da página (imagens, arquivos CSS e Javascript). As requisições subsequentes, entretanto, utilizam somente requisições assíncronas ao servidor, utilizando Javascript: uma requisição conhecida por \textit{Ajax} (Asynchronous JavaScript and XML). Estas requisições utilizam a camada REST do servidor que retornará respostas em JSON e cujo conteúdo será processado no cliente e montará as páginas de forma dinâmica. Desta forma, parte da lógica da aplicação como um todo é transferida para o cliente, reduzindo a carga no servidor.

\subsection{Alterações no modelo lógico}

O banco de dados relacional implementado em \textit{PostgreSQL} também sofreu algumas modificações em relação ao trabalho anterior. A figura \ref{fig:modelo-logico} mostra o esquema lógico do banco de dados da versão atual do SILQ.

Algumas mudanças pequenas de nomenclatura foram realizadas. Uma mudança significativa, porém, foi a unificação das tabelas \textit{tb\_dado\_geral} e \textit{tb\_profissional} para a nova tabela \textit{tb\_curriculum\_lattes}. A função destas duas tabelas antigas era guardar os currículos enviados de usuários e de pesquisadores de grupos, respectivamente. Nesta nova versão do SILQ, porém, em ambos os casos os currículos Lattes enviados pelo sistema são salvos na mesma tabela de currículos (\textit{tb\_curriculum\_lattes}), inclusive tendo seus registros reutilizados em caso de, por exemplo, dois usuários enviarem o mesmo currículo. Neste caso, o sistema armazena somente uma vez o currículo e cria duas referências diferentes a ele, poupando-o do trabalho de duplicar os dados do currículo Lattes, cuja representação em XML contém em média algumas dezenas de \textit{kilobytes}.

\begin{figure}[!h]
   \centering
   \caption{Novo esquema do modelo lógico do SILQ.}
   \label{fig:modelo-logico}
   \includegraphics[width=\textwidth]{figuras/modelo-logico.png}
\end{figure}

\subsection{Garantia da qualidade}

Para a garantia da qualidade desta nova versão do SILQ, foram introduzidas duas camadas de testes automatizados: a primeira, envolvendo \textit{testes unitários} e \textit{testes de integração} escritos em Java e com o objetivo de garantir a corretude do server-side da aplicação; e a segunda, basicamente um \textit{teste de sistema} escrito em Javascript e simulando casos de uso reais, garantindo a corretude do client-side e de sua integração com o servidor.

No SILQ, os testes unitários e de integração foram escritos em Java utilizando o framework de testes \textit{jUnit}\footnote{\url{http://junit.org/}}. Eles testam cada função da camada de serviço da aplicação, por exemplo simulando o upload de um currículo qualquer e verificando se os dados extraídos e retornados são de fato aqueles contidos no currículo. Foram criados testes, inclusive, para as funcionalidades já existentes desde o SILQ-1, mas que ainda não eram cobertos com casos de teste automatizados, para assim aumentar a confiabilidade do sistema e garantir que mudanças futuras não ocasionem \textit{bugs} nestes módulos antigos.

Este nível de teste, porém, não valida a interface de usuário e sua integração com a camada de serviço. Ou seja, todo o client-side da aplicação ainda está ``descoberto" de casos de testes. Para tanto, foram incluídos no SILQ casos de teste de sistema escritos em Javascript e utilizando o framework de testes \textit{Protractor}\footnote{\url{http://www.protractortest.org/}}, criado especificamente para testes \textit{end-to-end} de aplicações feitas com AngularJS. O Protractor simula as ações de um usuário real realizando cliques em botões, preenchendo formulários e navegando através de links da aplicação. Desta forma, são garantidos algum nível de corretude da interface do sistema e da integração entre o client e server side.
